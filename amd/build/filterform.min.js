define(["jquery","core/config","core/str","core/log"],function(a,b,c,d){var e=function(){this.oldusers="",this.ajaxloader=!1,this.SELECTORS={GROUPS:"select#groups",GROUPINGS:"select#groupings",MEMBERS:"select#users"}};e.prototype.get_members_ajaxurl=function(c){var d={url:b.wwwroot+"/local/checkmarkreport/getmembers.json.php",data:{courseid:a("input[name=id]").val(),userid:a("input[name=userid]").val(),groups:a(c.SELECTORS.GROUPS).val()}};return d},e.prototype.get_groups_ajaxurl=function(c){var d={url:b.wwwroot+"/local/checkmarkreport/getgroups.json.php",data:{courseid:a("input[name=id]").val(),userid:a("input[name=userid]").val(),groupings:a(c.SELECTORS.GROUPINGS).val()}};return d},e.prototype.update_members=function(b){b.preventDefault(),b.stopPropagation();var c=b.data.inst,e=b.data.strings,f=c.get_members_ajaxurl(c),g=a(c.SELECTORS.MEMBERS);if(!g)return void this.closest("form")[0].submit();var h={method:"get",url:f.url,data:f.data,dataType:"json",beforeSend:function(){d.info("Start members-request","checkmarkreport"),this.oldusers=a(c.SELECTORS.MEMBERS).children();var b=a(c.SELECTORS.MEMBERS);b&&a(c.SELECTORS.MEMBERS).html('<option class="loading" value="0">'+e.loading+"</option>")},success:function(b,e){for(var f="",g=0;g<b.length;g++)f+='<option value="'+b[g].id+'">'+b[g].name+"</option>";a(c.SELECTORS.MEMBERS).html(f),d.info("Request success: "+e,"checkmarkreport")},error:function(b,f){d.error(f,"checkmarkreport"),a(c.SELECTORS.MEMBERS).html('<option value="0">'+e.all+" "+e.members+e.error+"</option>")}};d.info("Click detected; beginning io request users."+f.url+f.data,"checkmarkreport"),a.ajax(h)},e.prototype.update_groups=function(b){b.preventDefault(),b.stopPropagation();var c=b.data.inst,e=b.data.strings,f=a(c.SELECTORS.GROUPS),g=c.get_groups_ajaxurl(c);if(!f)return void this.closest("form")[0].submit();var h={method:"GET",url:g.url,data:g.data,dataType:"json",beforeSend:function(){d.info("Start AJAX Call","checkmarkreport"),c.oldusers=a(c.SELECTORS.GROUPS).get("children"),a(c.SELECTORS.GROUPS).html('<option class="loading" value="0">'+e.loading+"</option>")},success:function(b){for(var d="",e=0;e<b.length;e++)d+='<option value="'+b[e].id+'">'+b[e].name+"</option>";a(c.SELECTORS.GROUPS).html(d)},error:function(b){d.error(b,"example"),a(c.SELECTORS.GROUPS).html('<option value="0">'+e.all+" "+e.groups+" "+e.error+"</option>")}};d.info("Click detected; beginning io request groups."+g.url+g.data,"checkmarkreport"),a.ajax(h)};var f=new e;return f.initializer=function(b){this.ajaxloader=b.ajaxloader,d.info("Initialize filterform JS","checkmarkreport"),a(this.SELECTORS.GROUPS).on("change",null,this,function(b){d.debug("Submit form!","checkmarkreport"),a(b.data.SELECTORS.GROUPS).closest("form")[0].submit()}),this.AJAXLOADER&&c.get_strings([{key:"loading",component:"local_checkmarkreport"},{key:"all",component:""},{key:"users",component:""},{key:"error_retriefing_members",component:"local_checkmarkreport"}]).done(function(b){var c={loading:b[0],all:b[1],members:b[2],error:b[3]};a(this.SELECTORS.GROUPS).on("change",null,{inst:this,strings:c},this.update_members)}).fail(function(a){d.error("Error retrieving strings: "+a,"checkmarkreport")}),a(this.SELECTORS.GROUPINGS).on("change",null,this,function(b){a(b.data.SELECTORS.GROUPINGS).closest("form")[0].submit()}),this.AJAXLOADER&&c.get_strings([{key:"loading",component:"local_checkmarkreport"},{key:"all",component:""},{key:"groups",component:""},{key:"error_retriefing_groups",component:"local_checkmarkreport"}]).done(function(b){var c={loading:b[0],all:b[1],groups:b[2],error:b[3]};a(this.SELECTORS.GROUPINGS).on("change",null,{inst:this,strings:c},this.update_groups)}).fail(function(a){d.error("Error retrieving strings: "+a,"checkmarkreport")}),a(this.SELECTORS.MEMBERS).on("change",null,this,function(b){a(b.data.SELECTORS.MEMBERS).closest("form")[0].submit()}),this.AJAXLOADER&&a(this.SELECTORS.MEMBERS).on("change",null,this,this.update_data),a("input[type=checkbox]").each(function(b,c){a(c).on("change",function(){a(c).closest("form")[0].submit()})})},f});